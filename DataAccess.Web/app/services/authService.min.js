"use strict";angular.module("DataAccessApp").service("authService",["$http","promiseFactory","ngUrlSettings","$localStorage",function(n,t,i,r){var f=i.serverApiUri,e=i.apiTokenUrl,u={};return u.authentication={isAuthorized:!1,token:"",username:"",role:"",id:"",useRefreshTokens:!1},u.login=function(f){var s="grant_type=password&username="+f.username+"&password="+f.password,o;return f.useRefreshTokens&&(s=s+"&client_id="+i.clientId),o=t.defer(),n.post(e,s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(n){r.authorizationData=f.useRefreshTokens?{id:n.id,token:n.access_token,username:n.userName,role:JSON.parse(n.role),refreshToken:n.refresh_token,useRefreshTokens:!0,isAuthorized:!0}:{token:n.access_token,username:n.username,role:n.role,id:n.id,refreshToken:"",useRefreshTokens:!1,isAuthorized:!0};u.loadAuthenticationData();o.resolve(n)}).error(function(n){o.reject(n)}),o.promise},u.isAuthorized=function(t){return n.get(f+"AuthenticationApi/IsAuthorized").then(function(){t()})},u.checkRole=function(n){for(var i=!1,t=0;t<n.length;++t)if(u.authentication.role.indexOf(n[t])>-1){i=!0;break}return i},u.logout=function(){var n=t.defer();return u.clearAuthenticationData(),n.resolve(!0),n.promise},u.loadAuthenticationData=function(){var n=r.authorizationData;return n&&(u.authentication.id=n.id,u.authentication.isAuthorized=n.isAuthorized,u.authentication.token=n.token,u.authentication.username=n.username,u.authentication.role=n.role,u.authentication.useRefreshTokens=n.useRefreshTokens),u.authentication},u.clearAuthenticationData=function(){r.$reset()},u}]);